<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale: 1.0" />
  <title>Zero Quest v13</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet" />

  <style>
    :root {
      --main-color: #0ff;
      --secondary-color: #0066ff;
      --bg-color: #000819;
      --error-color: #ff0066;
      --success-color: #00ff66;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-color);
      color: var(--main-color);
      font-family: 'VT323', monospace;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Reduzierte Scanlines */
    body::before {
      content: "";
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(
        transparent 50%, 
        rgba(0, 0, 0, 0.3) 50%
      );
      background-size: 100% 8px;
      pointer-events: none;
      z-index: 999;
      opacity: 0.3;
    }

    .content {
      position: relative;
      z-index: 1;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin: 40px 0;
    }

    header h1 {
      font-family: 'Press Start 2P', cursive;
      font-size: 2.5rem;
      color: var(--main-color);
      text-transform: uppercase;
      margin-bottom: 20px;
      line-height: 1.4;
      text-shadow: 4px 4px var(--secondary-color);
    }

    /* Auth Container */
    .auth-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 40px;
    }

    .auth-box {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid var(--main-color);
      padding: 20px;
      width: 300px;
    }

    .auth-box h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 1rem;
      margin-bottom: 20px;
      text-align: center;
    }

    /* Support Container */
    .support-container {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid var(--main-color);
      padding: 20px;
      margin-top: 20px;
      display: none; /* Wird per JS angezeigt wenn eingeloggt */
    }

    .support-container h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 1.2rem;
      margin-bottom: 20px;
      text-align: center;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      color: var(--main-color);
      font-size: 1.1rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 10px;
      background: rgba(0, 255, 255, 0.1);
      border: 2px solid var(--main-color);
      color: var(--main-color);
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2300ffff' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }

    .form-select option {
      background: var(--bg-color);
      color: var(--main-color);
    }

    .btn {
      font-family: 'Press Start 2P', cursive;
      padding: 10px 20px;
      background: transparent;
      color: var(--main-color);
      border: 2px solid var(--main-color);
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s;
      width: 100%;
    }

    .btn:hover {
      background: var(--main-color);
      color: var(--bg-color);
    }

    /* Tickets Liste */
    .tickets-list {
      margin-top: 20px;
    }

    .ticket-item {
      border: 1px solid var(--main-color);
      margin-bottom: 10px;
      padding: 15px;
      background: rgba(0, 255, 255, 0.05);
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: var(--secondary-color);
    }

    .ticket-content {
      font-size: 1.1rem;
    }

    /* Admin Panel */
    .admin-panel {
      display: none;
      margin-top: 40px;
      border: 2px solid var(--secondary-color);
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
    }

    .admin-panel h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 1.2rem;
      color: var(--secondary-color);
      margin-bottom: 20px;
      text-align: center;
    }

    /* Messages */
    .message {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid;
      text-align: center;
    }

    .message.error {
      border-color: var(--error-color);
      color: var(--error-color);
    }

    .message.success {
      border-color: var(--success-color);
      color: var(--success-color);
    }

    /* Navigation */
    .nav-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .nav-link {
      color: var(--main-color);
      text-decoration: none;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.8rem;
      padding: 5px 10px;
      border: 1px solid var(--main-color);
    }

    .nav-link:hover {
      background: var(--main-color);
      color: var(--bg-color);
    }

    /* Glitch Effect */
    .glitch-lines {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes glitch {
      0% {
        clip-path: none;
        transform: none;
        opacity: 0;
      }
      2% {
        clip-path: polygon(0 20%, 100% 20%, 100% 21%, 0 21%);
        transform: translate3d(-3px, 0, 0);
        opacity: 1;
      }
      4% {
        clip-path: none;
        transform: none;
        opacity: 0;
      }
      100% {
        clip-path: none;
        transform: none;
        opacity: 0;
      }
    }

    /* Neue Styles für Login/Admin */
    .user-info {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      font-family: 'Share Tech Mono', monospace;
    }

    .user-email {
      color: var(--main-color);
    }

    .logout-btn {
      font-family: 'Press Start 2P', cursive;
      padding: 5px 10px;
      font-size: 0.7rem;
      background: transparent;
      color: var(--main-color);
      border: 1px solid var(--main-color);
      cursor: pointer;
    }

    .logout-btn:hover {
      background: var(--main-color);
      color: var(--bg-color);
    }

    .admin-badge {
      background: var(--secondary-color);
      color: #fff;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    .protected-content {
      display: none; /* Wird per JS angezeigt wenn eingeloggt */
    }

    /* Support Ticket Styles */
    .ticket-form {
      margin-bottom: 30px;
    }

    .ticket-category {
      width: 100%;
      padding: 10px;
      background: rgba(0, 255, 255, 0.1);
      border: 2px solid var(--main-color);
      color: var(--main-color);
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    .ticket-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 0.8rem;
      margin-left: 10px;
    }

    .status-open {
      background: #00ff66;
      color: #000;
    }

    .status-closed {
      background: #ff0066;
      color: #fff;
    }

    /* Admin Controls */
    .admin-controls {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .admin-btn {
      font-family: 'Share Tech Mono', monospace;
      padding: 5px 10px;
      font-size: 0.8rem;
      background: transparent;
      color: var(--secondary-color);
      border: 1px solid var(--secondary-color);
      cursor: pointer;
    }

    .admin-btn:hover {
      background: var(--secondary-color);
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- Vorherige Effekt-Divs bleiben gleich -->
  <div class="glitch-lines"></div>
  

  <div class="content">
    <!-- User Info Box -->
    <div class="user-info">
      <span class="user-email"></span>
      <span class="admin-badge" style="display: none;">ADMIN</span>
      <button class="logout-btn">Logout</button>
    </div>

    <header>
      <h1>Zero Quest v13</h1>
      <p>Dein Portal in eine neue Dimension</p>
    </header>

    <!-- Original v13 Content -->
    

    

    <!-- Geschützter Bereich -->
    <div class="protected-content">
      <!-- Support Ticket Bereich -->
      <section class="comment-section">
        <h2 class="gallery-title">Support Ticket erstellen</h2>
        
        <form id="ticket-form" class="ticket-form">
          <div class="form-group">
            <label class="form-label" for="ticket-category">Kategorie:</label>
            <select id="ticket-category" class="ticket-category" required>
              <option value="">Bitte wählen...</option>
              <option value="technical">Technische Probleme</option>
              <option value="account">Account Probleme</option>
              <option value="billing">Zahlungsprobleme</option>
              <option value="other">Sonstiges</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="ticket-message">Nachricht:</label>
            <textarea id="ticket-message" class="form-textarea" required></textarea>
          </div>
          
          <button type="submit" class="submit-button">Ticket senden</button>
        </form>

        <div id="user-tickets">
          <h3 class="gallery-title">Meine Tickets</h3>
          <!-- Tickets werden hier per JS eingefügt -->
        </div>
      </section>

      <!-- Feedback Bereich -->
      <section class="comment-section">
        <h2 class="gallery-title">Feedback</h2>
        
        <div class="rating-container">
          <span class="rating-star" data-rating="1">★</span>
          <span class="rating-star" data-rating="2">★</span>
          <span class="rating-star" data-rating="3">★</span>
          <span class="rating-star" data-rating="4">★</span>
          <span class="rating-star" data-rating="5">★</span>
        </div>

        <form id="feedback-form" class="comment-form">
          <div class="form-group">
            <label class="form-label" for="feedback-text">Dein Feedback:</label>
            <textarea id="feedback-text" class="form-textarea" required></textarea>
          </div>
          
          <button type="submit" class="submit-button">Feedback senden</button>
        </form>

        <div id="feedback-list">
          <!-- Feedback wird hier per JS eingefügt -->
        </div>
      </section>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" style="display: none;">
      <section class="comment-section">
        <h2 class="gallery-title">Admin Panel</h2>
        
        <div id="all-tickets">
          <h3 class="gallery-title">Alle Support Tickets</h3>
          <!-- Alle Tickets werden hier per JS eingefügt -->
        </div>
        
        <div id="all-feedback">
          <h3 class="gallery-title">Alle Feedback</h3>
          <!-- Alles Feedback wird hier per JS eingefügt -->
        </div>
      </section>
    </div>

    <footer>
      &copy; 2025 Zero Quest. Alle Rechte vorbehalten.
    </footer>
  </div>

  <script>
    // Session Check
    const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
    if (!currentUser) {
      window.location.href = 'index-login.html';
    }

    // DOM Elements
    const userEmail = document.querySelector('.user-email');
    const adminBadge = document.querySelector('.admin-badge');
    const adminPanel = document.getElementById('admin-panel');
    const protectedContent = document.querySelector('.protected-content');
    const logoutBtn = document.querySelector('.logout-btn');

    // User Info anzeigen
    userEmail.textContent = currentUser.email;
    if (currentUser.isAdmin) {
      adminBadge.style.display = 'inline-block';
      adminPanel.style.display = 'block';
    }
    protectedContent.style.display = 'block';

    // Logout Handler
    logoutBtn.addEventListener('click', () => {
      sessionStorage.removeItem('currentUser');
      window.location.href = 'index-login.html';
    });

    // Daten aus localStorage laden
    let tickets = JSON.parse(localStorage.getItem('tickets')) || [];
    let feedback = JSON.parse(localStorage.getItem('feedback')) || [];

    // Support Ticket Handler
    document.getElementById('ticket-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const category = document.getElementById('ticket-category').value;
      const message = document.getElementById('ticket-message').value;
      
      const ticket = {
        id: Date.now(),
        category,
        message,
        userEmail: currentUser.email,
        date: new Date().toISOString(),
        status: 'open'
      };
      
      tickets.unshift(ticket);
      localStorage.setItem('tickets', JSON.stringify(tickets));
      
      e.target.reset();
      displayTickets();
    });

    // Feedback Handler
    document.getElementById('feedback-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const text = document.getElementById('feedback-text').value;
      const rating = currentRating;
      
      const newFeedback = {
        id: Date.now(),
        text,
        rating,
        userEmail: currentUser.email,
        date: new Date().toISOString()
      };
      
      feedback.unshift(newFeedback);
      localStorage.setItem('feedback', JSON.stringify(feedback));
      
      e.target.reset();
      displayFeedback();
    });

    // Tickets anzeigen
    function displayTickets() {
      const userTickets = document.getElementById('user-tickets');
      const allTickets = document.getElementById('all-tickets');
      
      // Benutzer-Tickets
      const userTicketsList = tickets
        .filter(t => t.userEmail === currentUser.email)
        .map(ticket => `
          <div class="comment-item">
            <div class="comment-header">
              <span>Kategorie: ${ticket.category}</span>
              <span class="ticket-status ${ticket.status === 'open' ? 'status-open' : 'status-closed'}">
                ${ticket.status.toUpperCase()}
              </span>
              <span>${new Date(ticket.date).toLocaleDateString()}</span>
            </div>
            <div class="comment-content">${ticket.message}</div>
          </div>
        `).join('');
      
      userTickets.innerHTML = `
        <h3 class="gallery-title">Meine Tickets</h3>
        ${userTicketsList}
      `;
      
      // Admin: Alle Tickets
      if (currentUser.isAdmin) {
        const allTicketsList = tickets.map(ticket => `
          <div class="comment-item">
            <div class="comment-header">
              <span>Von: ${ticket.userEmail}</span>
              <span>Kategorie: ${ticket.category}</span>
              <span class="ticket-status ${ticket.status === 'open' ? 'status-open' : 'status-closed'}">
                ${ticket.status.toUpperCase()}
              </span>
              <span>${new Date(ticket.date).toLocaleDateString()}</span>
            </div>
            <div class="comment-content">${ticket.message}</div>
            <div class="admin-controls">
              <button class="admin-btn" onclick="updateTicketStatus('${ticket.id}', '${ticket.status === 'open' ? 'closed' : 'open'}')">
                ${ticket.status === 'open' ? 'Schließen' : 'Öffnen'}
              </button>
              <button class="admin-btn" onclick="deleteTicket('${ticket.id}')">Löschen</button>
            </div>
          </div>
        `).join('');
        
        allTickets.innerHTML = `
          <h3 class="gallery-title">Alle Tickets</h3>
          ${allTicketsList}
        `;
      }
    }

    // Feedback anzeigen
    function displayFeedback() {
      const feedbackList = document.getElementById('feedback-list');
      const allFeedback = document.getElementById('all-feedback');
      
      // Benutzer-Feedback
      const userFeedbackList = feedback
        .filter(f => f.userEmail === currentUser.email)
        .map(item => `
          <div class="comment-item">
            <div class="comment-header">
              <span>Rating: ${'★'.repeat(item.rating)}</span>
              <span>${new Date(item.date).toLocaleDateString()}</span>
            </div>
            <div class="comment-content">${item.text}</div>
          </div>
        `).join('');
      
      feedbackList.innerHTML = userFeedbackList;
      
      // Admin: Alles Feedback
      if (currentUser.isAdmin) {
        const allFeedbackList = feedback.map(item => `
          <div class="comment-item">
            <div class="comment-header">
              <span>Von: ${item.userEmail}</span>
              <span>Rating: ${'★'.repeat(item.rating)}</span>
              <span>${new Date(item.date).toLocaleDateString()}</span>
            </div>
            <div class="comment-content">${item.text}</div>
            <div class="admin-controls">
              <button class="admin-btn" onclick="deleteFeedback('${item.id}')">Löschen</button>
            </div>
          </div>
        `).join('');
        
        allFeedback.innerHTML = `
          <h3 class="gallery-title">Alles Feedback</h3>
          ${allFeedbackList}
        `;
      }
    }

    // Admin Funktionen
    function updateTicketStatus(ticketId, newStatus) {
      tickets = tickets.map(ticket => 
        ticket.id === parseInt(ticketId) 
          ? {...ticket, status: newStatus}
          : ticket
      );
      localStorage.setItem('tickets', JSON.stringify(tickets));
      displayTickets();
    }

    function deleteTicket(ticketId) {
      if (confirm('Ticket wirklich löschen?')) {
        tickets = tickets.filter(ticket => ticket.id !== parseInt(ticketId));
        localStorage.setItem('tickets', JSON.stringify(tickets));
        displayTickets();
      }
    }

    function deleteFeedback(feedbackId) {
      if (confirm('Feedback wirklich löschen?')) {
        feedback = feedback.filter(item => item.id !== parseInt(feedbackId));
        localStorage.setItem('feedback', JSON.stringify(feedback));
        displayFeedback();
      }
    }

    // Initiale Anzeige
    displayTickets();
    displayFeedback();

    // Rating System
    let currentRating = 0;
    const stars = document.querySelectorAll('.rating-star');
    
    stars.forEach(star => {
      star.addEventListener('click', () => {
        currentRating = parseInt(star.dataset.rating);
        updateStars(currentRating);
      });
    });

    function updateStars(rating) {
      stars.forEach((star, index) => {
        if (index < rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }

    // Glitch Effekte vom Original v13
    function createGlitchLine() {
      const glitchContainer = document.querySelector('.glitch-lines');
      const line = document.createElement('div');
      
      line.style.position = 'absolute';
      line.style.top = Math.random() * 100 + '%';
      line.style.left = '0';
      line.style.right = '0';
      line.style.height = '2px';
      line.style.background = `rgba(0, 255, 255, ${Math.random() * 0.5})`;
      line.style.animation = 'glitch 0.5s linear forwards';
      
      glitchContainer.appendChild(line);
      
      setTimeout(() => {
        line.remove();
      }, 500);
    }

    setInterval(() => {
      if (Math.random() > 0.7) {
        createGlitchLine();
      }
    }, 200);
  </script>
</body>
</html>
